(window.webpackJsonp=window.webpackJsonp||[]).push([[18],{582:function(s,t,n){"use strict";n.r(t);var a=n(17),e=Object(a.a)({},(function(){var s=this,t=s.$createElement,n=s._self._c||t;return n("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[n("p",[s._v("ä¼—æ‰€å‘¨çŸ¥ï¼Œvue3 ç›¸æ¯”äº vue2 åœ¨ diff ç®—æ³•è¿™ä¸€å—æ›´æ–°ä¹Ÿå¾ˆå¤§ï¼Œå¹¶ä¸”è¿˜å¼•å…¥äº†æœ€é•¿è‡ªå¢å­åºåˆ—ç®—æ³•ã€‚è¿™ç¯‡æ–‡ç« ä¸»è¦ä¼šé€šè¿‡æ–‡å­—+ä»£ç æ³¨é‡Šçš„æ–¹å¼ï¼Œåˆ†æä¸€ä¸‹ vue3 å­èŠ‚ç‚¹æˆ‘è®¤ä¸ºæœ€å¤æ‚çš„ä¸€éƒ¨åˆ†ï¼Œä¹Ÿå°±æ˜¯æºç ä¸­çš„"),n("strong",[s._v("patchKeyedChildren")]),s._v("æ–¹æ³•ï¼Œæ˜¯å¦‚ä½•é€šè¿‡ diff ç®—æ³•æ›´æ–°çš„ã€‚å¯¹äºæœ€é•¿è‡ªå¢å­åºåˆ—ç®—æ³•ï¼Œæˆ‘ä¸ä¼šåœ¨è¿™ç¯‡æ–‡ç« ä¸­è¯¦ç»†è§£é‡Šï¼Œä½†æ˜¯ä¼šæ ¹æ®æˆ‘è‡ªå·±çš„ç†è§£ï¼Œè®²è§£ä¸€ä¸‹è¿™ä¸ªç®—æ³•æ€ä¹ˆåº”ç”¨åœ¨ dom æ›´æ–°ä¸Šã€‚å¦‚æœè¯»è€…æƒ³æ·±å…¥äº†è§£æœ€é•¿è‡ªå¢å­åºåˆ—ç®—æ³•ï¼Œå¯ä»¥é˜…è¯»æˆ‘çš„å¦å¤–ä¸€ç¯‡"),n("a",{attrs:{href:"https://juejin.cn/post/6997248460021825566",target:"_blank",rel:"noopener noreferrer"}},[s._v("æ–‡ç« "),n("OutboundLink")],1),s._v("ã€‚")]),s._v(" "),n("p",[n("strong",[s._v("patchKeyedChildren çš„æ–¹æ³•åœ¨@runtime-core/src/renderer.ts ä¸­ï¼Œå¦‚æœä¸æƒ³çœ‹æˆ‘æ–‡ç« ä¸­çš„ä»£ç èŠ‚é€‰çš„è¯ï¼Œå¯ä»¥æ‰“å¼€æºç å¯¹ç…§ã€‚æºç ä¸­ patchKeyedChildren åˆ†æˆäº† 5 ä¸ªéƒ¨åˆ†ï¼Œæ‰€ä»¥æˆ‘ä¹Ÿä¼šæ‹†åˆ†æˆ 5 éƒ¨åˆ†è¿›è¡Œåˆ†æã€‚")])]),s._v(" "),n("p",[s._v("å…ˆé€šè¿‡æ³¨é‡Šçœ‹çœ‹å‡½æ•°å‚æ•°å’Œå£°æ˜çš„å˜é‡")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" patchKeyedChildren "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("c1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" VNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ—§èŠ‚ç‚¹é›†åˆ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("c2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" VNodeArrayChildren"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("  "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°èŠ‚ç‚¹é›†åˆ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("container")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" RendererElement"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// çˆ¶å®¹å™¨")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("parentAnchor")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" RendererNode "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é”šç‚¹")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("parentComponent")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" ComponentInternalInstance "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»¥ä¸‹å‚æ•°å’Œdiffæ— å…³")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("parentSuspense")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" SuspenseBoundary "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("isSVG")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" boolean"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("slotScopeIds")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" string"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("|")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token literal-property property"}},[s._v("optimized")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" boolean\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" l2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°å­èŠ‚ç‚¹é•¿åº¦")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" e1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// prev ending index")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" e2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" l2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// next ending index")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br")])]),n("ol",[n("li",[n("p",[s._v("è¿™ä¸€æ­¥å’Œ vue2 diff ä¸€æ ·ï¼Œå…ˆä»ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å¤´ç´¢å¼•é€æ­¥å‘ä¸‹ ğŸ‘‡ æ¯”è¾ƒï¼Œç›´åˆ°ä¸¤ä¸ªèŠ‚ç‚¹ä¸æ˜¯åŒä¸€ä¸ªèŠ‚ç‚¹çš„æ—¶å€™ breakã€‚ä»æ³¨é‡Šå¯ä»¥çœ‹å‡ºï¼ŒæŒ‡é’ˆä¼šä¸€ç›´ä¸‹ç§»é€šè¿‡ aã€bï¼Œç„¶åå‘ç° c å’Œ d ä¸æ˜¯åŒä¸ªèŠ‚ç‚¹ï¼Œäºæ˜¯é€€å‡ºè¿™ä¸€æ¬¡çš„ while å¾ªç¯ã€‚")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. sync from start")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (a b) c")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (a b) d e")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" n1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" n2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" optimized\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cloneIfMounted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("normalizeVNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isSameVNodeType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" isSVG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" slotScopeIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" optimized"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("è¿™ä¸€æ­¥è¿˜æ˜¯å’Œ vue2 diff ä¸€æ ·ï¼Œä»ä¸¤ä¸ªå­èŠ‚ç‚¹çš„å°¾ç´¢å¼•é€æ­¥å‘ä¸Š ğŸ‘† æ¯”è¾ƒã€‚")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. sync from end")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a (b c)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// d e (b c)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" n1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("e1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" n2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" optimized\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cloneIfMounted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("normalizeVNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("isSameVNodeType")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("n1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" n2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      n1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      n2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      isSVG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      slotScopeIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      optimized\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("break")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  e1"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n  e2"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("å®Œæˆäº†å¤´å¤´/å°¾å°¾æ¯”è¾ƒåï¼Œæ­¤æ—¶ä¼šåˆ¤æ–­ä¸€ä¸‹ï¼Œå› ä¸ºè¿™æ—¶å€™å¯èƒ½æ–°èŠ‚ç‚¹éå†å®Œäº†å‰©ä¸‹è€èŠ‚ç‚¹ï¼Œæˆ–è€…è€èŠ‚ç‚¹éå†å®Œäº†å‰©ä¸‹æ–°èŠ‚ç‚¹ã€‚ç¬¬ 3âƒ£ï¸ æ­¥åˆ¤æ–­çš„æ˜¯å‰©ä¸‹æ–°èŠ‚ç‚¹çš„æƒ…å†µï¼Œè¿™æ—¶å€™ patch ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯ nullï¼Œç›´æ¥æŠŠæ–°èŠ‚ç‚¹æŒ‚è½½ä¸Šå»å°±å¯ä»¥äº†ã€‚")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. common sequence + mount")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (a b)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (a b) c")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// i = 2, e1 = 1, e2 = 2")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (a b)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// c (a b)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// i = 0, e1 = -1, e2 = 0")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" e1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" nextPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" anchor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" nextPos "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" l2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nextPos"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("el "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" parentAnchor\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" optimized "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cloneIfMounted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("normalizeVNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        anchor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        isSVG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        slotScopeIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        optimized\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("è¿™ä¸€æ­¥åˆ¤æ–­çš„å°±æ˜¯å‰©ä½™è€èŠ‚ç‚¹çš„æƒ…å†µï¼Œå¤„ç†æ–¹å¼éå¸¸ç®€å•ï¼ŒæŠŠå‰©ä½™çš„è€èŠ‚ç‚¹ç›´æ¥ç§»é™¤å³å¯ã€‚")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 4. common sequence + unmount")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (a b) c")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (a b)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// i = 2, e1 = 2, e2 = 1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a (b c)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// (b c)")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// i = 0, e1 = 0, e2 = -1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">")]),s._v(" e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("while")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unmount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n        i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("åˆ°æœ€åä¸€æ­¥äº†ï¼Œè¿™ä¸€æ­¥ä¹Ÿæ˜¯ vue3 å˜åŒ–æœ€å¤§çš„ä¸€æ­¥ã€‚å…ˆæ¥çœ‹çœ‹å®ƒæ˜¯å¤„ç†ä»€ä¹ˆæƒ…å†µçš„")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a b [c f g h] x y")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a b [f h g c] x y")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("p",[s._v("è¿™é‡Œå¯ä»¥çœ‹å‡ºï¼Œç»è¿‡å¤´å¤´å°¾å°¾ç§»åŠ¨æŒ‡é’ˆç¼©çª„èŒƒå›´åï¼Œå‰©ä¸‹[]é‡Œé¢çš„å››ä¸ªå…ƒç´ è¿˜è¦å¯¹æ¯”ï¼Œå¦‚æœæ˜¯ vueï¼Œæ˜¯ä¼šæ–°åæ—§å‰/æ–°å‰æ—§åå†æ¬¡ç§»åŠ¨æŒ‡é’ˆã€‚è€Œ vue3 å¯¹è¿™ä¸€å—åˆç»†åˆ†æˆäº†ä¸‰éƒ¨åˆ†ï¼Œå…ˆæ¥çœ‹çœ‹å£°æ˜çš„å˜é‡")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" s1 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// prev starting index")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" s2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// next starting index")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("ol",[n("li",[n("p",[s._v("å…ˆå£°æ˜äº†ä¸€ä¸ª keyToNewIndexMapï¼Œå…ˆçœ‹çœ‹è¿™ä¸ª map çš„ç»“æ„ä¾¿äºé˜…è¯»ï¼Œå°±æ˜¯æ–°èŠ‚ç‚¹çš„ key å’Œ index çš„æ˜ å°„ã€‚")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//[c f g h] old")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//[f h g c] new")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"f"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"h"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"g"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("2")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v('"c"')]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("3")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br")])]),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 5.1 build key:index map for newChildren")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" keyToNewIndexMap "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Map")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" nextChild "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" optimized\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("cloneIfMounted")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("normalizeVNode")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç†Ÿæ‚‰çš„è­¦å‘Šâš ï¸")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      process"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("env"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("NODE_ENV")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("'production'")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("&&")]),s._v("\n      keyToNewIndexMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("has")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("warn")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("Duplicate keys found during update:")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("JSON")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("stringify")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token template-string"}},[n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")]),n("span",{pre:!0,attrs:{class:"token string"}},[s._v("Make sure keys are unique.")]),n("span",{pre:!0,attrs:{class:"token template-punctuation string"}},[s._v("`")])]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n    keyToNewIndexMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("set")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("è¿™ä¸€å—çš„ä»£ç ä¼šæœ‰ç‚¹å¤šï¼Œä¸»è¦å°±æ˜¯åˆ¤æ–­äº†ä¸€ä¸‹æ˜¯å¦éœ€è¦ç§»åŠ¨å­èŠ‚ç‚¹ï¼Œå¹¶ä¸”å£°æ˜äº†ä¸€ä¸ªæ•°ç»„ï¼Œè®°å½•äº†æ–°èŠ‚ç‚¹åœ¨æ—§èŠ‚ç‚¹æ•°ç»„çš„ä½ç½®ï¼Œå¦‚æœå­èŠ‚ç‚¹éœ€è¦ç§»åŠ¨ï¼Œé‚£è¿™ä¸ªæ•°ç»„å°±å¯ä»¥ä¸ºåç»­æœåŠ¡ã€‚æˆ‘ä»¬å¯ä»¥å…ˆç»“åˆæ³¨é‡Šæ¥çœ‹ï¼Œä¸¾ä¸ªä¾‹å­ ğŸŒ°")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a b [c f g h] x y")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// a b [f h g c] x y")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// s1 = s2 = å¤´æŒ‡é’ˆä½ç½®  è¿™é‡Œ=2 æŒ‡å‘æ–°èŠ‚ç‚¹[]ç¬¬ä¸€ä¸ªå…ƒç´ ")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// e2 = å°¾æŒ‡ä½ç½® è¿™é‡Œ=5 æŒ‡å‘æ–°èŠ‚ç‚¹[]æœ€åä¸€ä¸ªå…ƒç´ ")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br")])]),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" j\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è®°å½•å·²ç»patchè¿‡çš„æ•°é‡")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" patched "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// éœ€è¦patchedçš„æ€»æ•°é‡ æ‰€ä»¥è¿™é‡Œå°±æ˜¯æ–°èŠ‚ç‚¹[]é‡Œé¢çš„é•¿åº¦=4")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" toBePatched "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" e2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" s2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ˜¯å¦éœ€è¦ç§»åŠ¨ ç¨åä¼šä¸¾ä¾‹è¯´æ˜ä»€ä¹ˆæƒ…å†µæ˜¯ä¸éœ€è¦ç§»åŠ¨çš„")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" moved "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("false")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨æ¥åˆ¤æ–­æ˜¯å¦éœ€è¦ç§»åŠ¨ ä¹Ÿä¼šä¸¾ä¾‹è¯´æ˜")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" maxNewIndexSoFar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™ä¸ªnewIndexToOldIndexMapåˆå§‹åŒ–é•¿è¿™æ · [0,0,0,0]")]),s._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç”¨æ¥è®°å½•æ–°èŠ‚ç‚¹åœ¨æ—§èŠ‚ç‚¹[]çš„ä½ç½®")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" newIndexToOldIndexMap "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("new")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token class-name"}},[s._v("Array")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("toBePatched"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" toBePatched"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" newIndexToOldIndexMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v("\n\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¼€å§‹å¾ªç¯æ—§çš„èŠ‚ç‚¹")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<=")]),s._v(" e1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" prevChild "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c1"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v("\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯patchä¸€ä¸ªæ–°èŠ‚ç‚¹ patched++ è¿™é‡Œè¯´æ˜æ–°èŠ‚ç‚¹å·²ç»patchå®Œäº†")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("patched "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" toBePatched"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰€ä»¥ç›´æ¥æŠŠæ—§èŠ‚ç‚¹ç§»é™¤")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unmount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prevChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("continue")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("let")]),s._v(" newIndex\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ ¹æ®key ä»æ–°èŠ‚ç‚¹é‡Œé¢è·å–å¯¹åº”çš„ç´¢å¼•")]),s._v("\n\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯”å¦‚æ—§èŠ‚ç‚¹çš„cåœ¨ç¬¬ä¸€ä½ æ–°èŠ‚ç‚¹ä¸º[f h g c] è·å–åˆ°çš„nexIndexå°±æ˜¯3")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prevChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n          newIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" keyToNewIndexMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("get")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prevChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("key"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ²¡æœ‰keyçš„æƒ…å†µ ç•¥")]),s._v("\n\t\t       "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//......")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n\n        "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("undefined")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ—§èŠ‚ç‚¹åœ¨æ–°èŠ‚ç‚¹çš„mapä¸­æ‰¾ä¸åˆ° ç›´æ¥åˆ é™¤")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ¯”å¦‚ x[c f]y x[f]y cå°±ä¼šåˆ é™¤")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("unmount")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("prevChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰¾åˆ°äº† è®°å½•ä¸€ä¸‹ æ³¨æ„è¿™é‡Œi+1äº† ä¹Ÿå°±æ˜¯")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [c f g h] [f h g c]ç”Ÿæˆçš„newIndexToOldIndexMapæ˜¯")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [2,4,3,1] å†æ¬¡æ³¨æ„âš ï¸ +1äº†")]),s._v("\n          newIndexToOldIndexMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("newIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" s2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n\t\t\t\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œç¨åè¯¦è§£ å¯ä»¥çœ‹åˆ°æ˜¯è¿™é‡Œæ“ä½œäº†move")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" maxNewIndexSoFar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            maxNewIndexSoFar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" newIndex\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n            moved "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n          "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n            prevChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("newIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" VNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            isSVG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            slotScopeIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n            optimized\n          "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n          patched"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("++")]),s._v("\n        "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br"),n("span",{staticClass:"line-number"},[s._v("45")]),n("br"),n("span",{staticClass:"line-number"},[s._v("46")]),n("br"),n("span",{staticClass:"line-number"},[s._v("47")]),n("br"),n("span",{staticClass:"line-number"},[s._v("48")]),n("br"),n("span",{staticClass:"line-number"},[s._v("49")]),n("br"),n("span",{staticClass:"line-number"},[s._v("50")]),n("br"),n("span",{staticClass:"line-number"},[s._v("51")]),n("br"),n("span",{staticClass:"line-number"},[s._v("52")]),n("br"),n("span",{staticClass:"line-number"},[s._v("53")]),n("br"),n("span",{staticClass:"line-number"},[s._v("54")]),n("br"),n("span",{staticClass:"line-number"},[s._v("55")]),n("br"),n("span",{staticClass:"line-number"},[s._v("56")]),n("br"),n("span",{staticClass:"line-number"},[s._v("57")]),n("br"),n("span",{staticClass:"line-number"},[s._v("58")]),n("br"),n("span",{staticClass:"line-number"},[s._v("59")]),n("br"),n("span",{staticClass:"line-number"},[s._v("60")]),n("br"),n("span",{staticClass:"line-number"},[s._v("61")]),n("br"),n("span",{staticClass:"line-number"},[s._v("62")]),n("br")])]),n("p",[s._v("è¿™é‡Œè¿˜æ˜¯éœ€è¦ä¸¾ä¾‹è¯´æ˜ä¸€ä¸‹ maxNewIndexSoFar å’Œ move çš„å·¦å³")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" maxNewIndexSoFar"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  maxNewIndexSoFar "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" newIndex\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  moved "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token boolean"}},[s._v("true")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// maxNewIndexSoFar é»˜è®¤=0 maxNewIndexSoFarå…¶å®å°±æ˜¯è®°å½•ä¸Šä¸€ä¸ªnewIndex")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å…ˆæ¥çœ‹çœ‹ä¸éœ€è¦ç§»åŠ¨çš„åœºæ™¯ xy[ab]z x[ab]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// nexIndexæ˜¯æ–°èŠ‚ç‚¹åœ¨æ—§èŠ‚ç‚¹[]çš„ä½ç½® å¯ä»¥çœ‹å‡º éå†æ—§èŠ‚ç‚¹[]çš„æ—¶å€™")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœèŠ‚ç‚¹é¡ºåºä¸å˜ é‚£ä¹ˆnexIndexæ€»æ˜¯é€’å¢çš„ aæ˜¯0 bæ˜¯1 æ‰€ä»¥æ¯ä¸€æ¬¡å¾ªç¯ newIndexæ€»æ˜¯")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¤§äºä¸Šä¸€ä¸ªçš„newIndex")]),s._v("\n\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å¦‚æœæ˜¯ xy[ab]z x[ba]")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// éå†åˆ°æ—§èŠ‚ç‚¹bçš„æ—¶å€™ newIndexæ˜¯0ï¼Œä½†æ˜¯ä¸Šä¸€æ¬¡newIndexä¹Ÿå°±æ˜¯maxNewIndexSoFaræ˜¯1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ‰€ä»¥moveæ”¹ä¸ºtrue")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br")])])]),s._v(" "),n("li",[n("p",[s._v("ä¸Šé¢æ­¥éª¤åˆ¤æ–­äº†æ–°å­èŠ‚ç‚¹æ˜¯å¦éœ€è¦ moveï¼Œé‚£ä¹ˆè¿™ä¸€æ­¥å°±æ˜¯å†³å®šæ–°å­èŠ‚ç‚¹æ€ä¹ˆæ · move")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ğŸŒ°")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [c f g h] old")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [f h g c] new")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¯¦ç»†é€»è¾‘éœ€è¦çœ‹å¦å¤–ä¸€ç¯‡æ–‡ç«  å¼€å¤´åˆæ³¨æ˜ æˆ–è€…é€šè¿‡å…¶ä»–æ–‡ç« äº†è§£")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// è¿™é‡Œè¿”å›[0,2] æ³¨æ„è¿™æ˜¯ç´¢å¼• ä¹Ÿå°±æ˜¯[f g]æ˜¯æœ€é•¿è‡ªå¢å­åºåˆ—")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" increasingNewIndexSequence "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" moved\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// getSequenceå°±æ˜¯è·å–æœ€é•¿è‡ªå¢å­åºåˆ—")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("getSequence")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newIndexToOldIndexMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("EMPTY_ARR")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æœ€é•¿è‡ªå¢å­åºåˆ—çš„é•¿åº¦")]),s._v("\nj "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" increasingNewIndexSequence"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("length "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ä»åå‘å‰å¼€å§‹éå†")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("for")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" toBePatched "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(">=")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v(" i"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" nextIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" s2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" i\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// æ–°èŠ‚ç‚¹")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" nextChild "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nextIndex"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" VNode\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// parentAnchoræš‚æ—¶ä¸æ¸…æ¥šæ˜¯ä»€ä¹ˆé€»è¾‘ç”Ÿæˆ ä½†æ˜¯å¦‚æœå½“å‰èŠ‚ç‚¹ä¸æ˜¯æœ€åä¸€ä¸ªèŠ‚ç‚¹")]),s._v("\n\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å°±ç”¨ä¸ä¸ŠparentAnchor anchorå–çš„åˆ™æ˜¯å½“å‰èŠ‚ç‚¹çš„ä¸‹ä¸€ä¸ªèŠ‚ç‚¹")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("const")]),s._v(" anchor "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v("\n    nextIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" l2 "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("?")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("c2"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("nextIndex "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("as")]),s._v(" VNode"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("el "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v(":")]),s._v(" parentAnchor\n  "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("newIndexToOldIndexMap"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("i"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("===")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// newIndexToOldIndexMapé»˜è®¤å¡«å……äº†0 å¦‚æœåˆ°è¿™é‡Œè¿˜æ˜¯0 è¯´æ˜æ–°èŠ‚ç‚¹ä¸åœ¨æ—§èŠ‚ç‚¹é‡Œé¢")]),s._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç›´æ¥æ–°å¢")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("patch")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("null")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      nextChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      anchor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      parentComponent"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      parentSuspense"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      isSVG"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      slotScopeIds"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v("\n      optimized\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("moved"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//éœ€è¦ç§»åŠ¨")]),s._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 1. j<0 è¯´æ˜increasingNewIndexSequenceéå†å®Œäº† è¿˜æœ‰å‰©ä½™çš„æ–°èŠ‚ç‚¹")]),s._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 2. i ä¸åœ¨increasingNewIndexSequenceé‡Œé¢ iæ˜¯éœ€è¦ç§»åŠ¨çš„")]),s._v("\n\t\t"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// 3. å¦‚æœå½“å‰èŠ‚ç‚¹åœ¨increasingNewIndexSequenceé‡Œé¢ï¼Œé‚£ä¹ˆä¸åšä»»ä½•æ“ä½œ")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("if")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("j "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("<")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token number"}},[s._v("0")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("||")]),s._v(" i "),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("!==")]),s._v(" increasingNewIndexSequence"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("[")]),s._v("j"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("]")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      "),n("span",{pre:!0,attrs:{class:"token function"}},[s._v("move")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),s._v("nextChild"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" container"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" anchor"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" MoveType"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),n("span",{pre:!0,attrs:{class:"token constant"}},[s._v("REORDER")]),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("else")]),s._v(" "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n      j"),n("span",{pre:!0,attrs:{class:"token operator"}},[s._v("--")]),s._v("\n    "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n  "),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br"),n("span",{staticClass:"line-number"},[s._v("4")]),n("br"),n("span",{staticClass:"line-number"},[s._v("5")]),n("br"),n("span",{staticClass:"line-number"},[s._v("6")]),n("br"),n("span",{staticClass:"line-number"},[s._v("7")]),n("br"),n("span",{staticClass:"line-number"},[s._v("8")]),n("br"),n("span",{staticClass:"line-number"},[s._v("9")]),n("br"),n("span",{staticClass:"line-number"},[s._v("10")]),n("br"),n("span",{staticClass:"line-number"},[s._v("11")]),n("br"),n("span",{staticClass:"line-number"},[s._v("12")]),n("br"),n("span",{staticClass:"line-number"},[s._v("13")]),n("br"),n("span",{staticClass:"line-number"},[s._v("14")]),n("br"),n("span",{staticClass:"line-number"},[s._v("15")]),n("br"),n("span",{staticClass:"line-number"},[s._v("16")]),n("br"),n("span",{staticClass:"line-number"},[s._v("17")]),n("br"),n("span",{staticClass:"line-number"},[s._v("18")]),n("br"),n("span",{staticClass:"line-number"},[s._v("19")]),n("br"),n("span",{staticClass:"line-number"},[s._v("20")]),n("br"),n("span",{staticClass:"line-number"},[s._v("21")]),n("br"),n("span",{staticClass:"line-number"},[s._v("22")]),n("br"),n("span",{staticClass:"line-number"},[s._v("23")]),n("br"),n("span",{staticClass:"line-number"},[s._v("24")]),n("br"),n("span",{staticClass:"line-number"},[s._v("25")]),n("br"),n("span",{staticClass:"line-number"},[s._v("26")]),n("br"),n("span",{staticClass:"line-number"},[s._v("27")]),n("br"),n("span",{staticClass:"line-number"},[s._v("28")]),n("br"),n("span",{staticClass:"line-number"},[s._v("29")]),n("br"),n("span",{staticClass:"line-number"},[s._v("30")]),n("br"),n("span",{staticClass:"line-number"},[s._v("31")]),n("br"),n("span",{staticClass:"line-number"},[s._v("32")]),n("br"),n("span",{staticClass:"line-number"},[s._v("33")]),n("br"),n("span",{staticClass:"line-number"},[s._v("34")]),n("br"),n("span",{staticClass:"line-number"},[s._v("35")]),n("br"),n("span",{staticClass:"line-number"},[s._v("36")]),n("br"),n("span",{staticClass:"line-number"},[s._v("37")]),n("br"),n("span",{staticClass:"line-number"},[s._v("38")]),n("br"),n("span",{staticClass:"line-number"},[s._v("39")]),n("br"),n("span",{staticClass:"line-number"},[s._v("40")]),n("br"),n("span",{staticClass:"line-number"},[s._v("41")]),n("br"),n("span",{staticClass:"line-number"},[s._v("42")]),n("br"),n("span",{staticClass:"line-number"},[s._v("43")]),n("br"),n("span",{staticClass:"line-number"},[s._v("44")]),n("br")])]),n("p",[s._v("ä¸¾ä¾‹è¯´æ˜")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [c f g h] old")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// [f h g c] new")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// increasingNewIndexSequence = [0,2]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("p",[s._v("æˆ‘ä»¬è‚‰çœ¼è§‚çœ‹å¯çŸ¥ï¼Œæ—§èŠ‚ç‚¹çš„ fg ä¸éœ€è¦ç§»åŠ¨ï¼Œå°±å¯ä»¥å®ç°æ–°èŠ‚ç‚¹çš„ä½ç½®ï¼Œè¿™å°±æ˜¯æœ€é•¿è‡ªå¢å­åºåˆ—çš„ä½œç”¨ï¼Œå®ç° dom çš„æœ€å°ç§»åŠ¨æ¬¡æ•°ã€‚è¦ç§»åŠ¨çš„ï¼Œåªæœ‰ gc ä¸¤ä¸ªèŠ‚ç‚¹ã€‚")]),s._v(" "),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¬¬ä¸€æ¬¡ç§»åŠ¨ æ‹¿åˆ°çš„æ˜¯cèŠ‚ç‚¹ å› ä¸ºcèŠ‚ç‚¹åé¢æ²¡æœ‰èŠ‚ç‚¹ æ‰€ä»¥å‚è€ƒèŠ‚ç‚¹æ˜¯parentAnchor")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// å®é™…æ•ˆæœæ˜¯cèŠ‚ç‚¹æ’å…¥åˆ°äº†çˆ¶å®¹å™¨æœ€å é¡µé¢å˜æˆ [f g h c]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br")])]),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//ç¬¬äºŒæ¬¡ç§»åŠ¨ æ‹¿åˆ°gèŠ‚ç‚¹ åœ¨increasingNewIndexSequenceé‡Œé¢ï¼Œä»€ä¹ˆä¹Ÿä¸å¹²")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])]),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// ç¬¬ä¸‰æ¬¡ç§»åŠ¨ æ‹¿åˆ°hèŠ‚ç‚¹ å‚è€ƒèŠ‚ç‚¹æ‹¿å½“å‰èŠ‚ç‚¹åä¸€ä¸ª å°±æ˜¯gèŠ‚ç‚¹")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// moveæ–¹æ³•å…¶å®å°±æ˜¯insertBefore æ‰€ä»¥hèŠ‚ç‚¹ç§»åŠ¨åˆ°äº†gèŠ‚ç‚¹å‰é¢")]),s._v("\n"),n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// é¡µé¢å˜æˆ [f h g c ]")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br"),n("span",{staticClass:"line-number"},[s._v("2")]),n("br"),n("span",{staticClass:"line-number"},[s._v("3")]),n("br")])]),n("div",{staticClass:"language-jsx line-numbers-mode"},[n("pre",{pre:!0,attrs:{class:"language-jsx"}},[n("code",[n("span",{pre:!0,attrs:{class:"token comment"}},[s._v("// åŒç¬¬äºŒæ¬¡ç§»åŠ¨ ä»€ä¹ˆä¹Ÿä¸å¹² é¡µé¢è¿˜æ˜¯ [f h g c] å’Œæ–°èŠ‚ç‚¹vnodeé¡ºåºå¯¹åº”ä¸Šäº†")]),s._v("\n")])]),s._v(" "),n("div",{staticClass:"line-numbers-wrapper"},[n("span",{staticClass:"line-number"},[s._v("1")]),n("br")])])])]),s._v(" "),n("p",[s._v("æ€»ä½“æ„Ÿè§‰ï¼Œvue3 diff ç®—æ³•è¾ƒéš¾ç†è§£çš„ç‚¹åœ¨æœ€é•¿è‡ªå¢å­åºåˆ—çš„è®¡ç®—ï¼Œå¹¶ä¸”åº”ç”¨åœ¨ dom ç§»åŠ¨ä¸Šï¼Œè¿˜æœ‰å°±æ˜¯æ˜¯å¦éœ€è¦ move çš„åˆ¤æ–­ã€‚æºç é˜…è¯»ä½“éªŒè¿˜æ˜¯æ¯” vue2n ä¸ª if else æ¸…æ™°ç›´è§‚ï¼Œå¹¶ä¸”æºç é‡Œé¢ä¹Ÿæœ‰å¯¹åº”åœºæ™¯çš„æ³¨é‡Šã€‚")]),s._v(" "),n("p",[s._v("æœ€åæ€»ç»“ä¸€ä¸‹ï¼š")]),s._v(" "),n("ol",[n("li",[s._v("å¤´å¤´æ¯”è¾ƒï¼Œç›®çš„æ˜¯å‘ä¸‹ç§»åŠ¨æŒ‡é’ˆç¼©å° diff èŒƒå›´")]),s._v(" "),n("li",[s._v("å°¾å°¾æ¯”è¾ƒï¼Œç›®çš„åŒä¸Š")]),s._v(" "),n("li",[s._v("ç»è¿‡ 1ã€2 æ­¥éª¤åï¼Œå‰©ä½™äº†æ–°èŠ‚ç‚¹å°±ç›´æ¥æ’å…¥æ–°èŠ‚ç‚¹")]),s._v(" "),n("li",[s._v("ç»è¿‡ 1ã€2 æ­¥éª¤åï¼Œå‰©ä½™äº†è€èŠ‚ç‚¹å°±ç›´æ¥åˆ é™¤æ–°èŠ‚ç‚¹")]),s._v(" "),n("li",[s._v("ä»¥ä¸Šåœºæ™¯éƒ½ä¸ç¬¦åˆï¼Œåˆ™è¿›è¡Œï¼š\n"),n("ol",[n("li",[s._v("æ–°å­èŠ‚ç‚¹å»ºç«‹ key ä¸ç´¢å¼•çš„æ˜ å°„å…³ç³»ï¼ŒkeyToNewIndexMap")]),s._v(" "),n("li",[s._v("åˆ¤æ–­æ–°å­èŠ‚ç‚¹æ˜¯å¦éœ€è¦ç§»åŠ¨ï¼Œå¹¶ä¸”æ‰¾åˆ°æ–°å­èŠ‚ç‚¹åœ¨æ—§å­èŠ‚ç‚¹ä¸­çš„ä½ç½® newIndexToOldIndexMap")]),s._v(" "),n("li",[s._v("éå†å‰©ä½™æ–°å­èŠ‚ç‚¹ï¼Œå¦‚æœä¸åœ¨ newIndexToOldIndexMap é‡Œé¢åˆ™æ–°å¢ï¼Œå¦‚æœåœ¨å¹¶ä¸”éœ€è¦ move çš„è¯ï¼Œæ ¹æ®è·å–åˆ°æœ€é•¿è‡ªå¢å­åºåˆ—è¿›è¡Œç§»åŠ¨ã€‚")])])])])])])])}),[],!1,null,null,null);t.default=e.exports}}]);